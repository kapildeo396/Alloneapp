<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>News Portal</title>
  <style>
    #upload-section, #admin-login {
      display: none;
    }
  </style>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <h1>News Portal</h1>

  <!-- Admin Login Section (Hidden by Default) -->
  <div id="admin-login">
    <h2>Admin Login</h2>
    <label for="admin-key">Enter Admin Key:</label>
    <input type="password" id="admin-key">
    <button id="admin-login-btn">Login</button>
    <p id="login-error" style="color: red; display: none;">Invalid Admin Key!</p>
  </div>

  <!-- News Upload Section (Hidden by Default) -->
  <div id="upload-section">
    <h2>Upload News</h2>
    <form id="news-form">
      <label for="news-title">Title:</label>
      <input type="text" id="news-title" required><br><br>

      <label for="news-content">Content:</label>
      <textarea id="news-content" required></textarea><br><br>

      <label for="news-image">Image:</label>
      <input type="file" id="news-image" accept="image/*"><br><br>

      <button type="submit">Upload</button>
    </form>
    <button id="download-json">Download JSON</button>
  </div>

  <!-- News Display Section -->
  <div id="news-display">
    <h2>Latest News</h2>
    <div id="news-container"></div>
  </div>

  <script>
    const ADMIN_KEY = "mysecureadminkey"; // Change this to your secure key

    // URL Parameters Check
    const urlParams = new URLSearchParams(window.location.search);
    const isAdmin = urlParams.get('admin') === 'true';

    if (isAdmin) {
      document.getElementById('admin-login').style.display = 'block';
    }

    document.getElementById('admin-login-btn').addEventListener('click', () => {
      const enteredKey = document.getElementById('admin-key').value;

      if (enteredKey === ADMIN_KEY) {
        document.getElementById('admin-login').style.display = 'none';
        document.getElementById('upload-section').style.display = 'block';
      } else {
        document.getElementById('login-error').style.display = 'block';
      }
    });

    // Load News from Local Storage
    const loadNews = () => {
      const storedNews = localStorage.getItem('newsData');
      return storedNews ? JSON.parse(storedNews) : [];
    };

    const saveNews = (newsData) => {
      localStorage.setItem('newsData', JSON.stringify(newsData));
    };

    let newsData = loadNews();
    renderNews();

    document.getElementById('news-form').addEventListener('submit', (event) => {
      event.preventDefault();

      const title = document.getElementById('news-title').value;
      const content = document.getElementById('news-content').value;
      const imageFile = document.getElementById('news-image').files[0];

      const reader = new FileReader();
      reader.onload = function () {
        const imageBase64 = reader.result;

        const newNews = { title, content, image: imageBase64 };
        newsData.push(newNews);
        saveNews(newsData);
        renderNews();
        document.getElementById('news-form').reset();
      };

      if (imageFile) {
        reader.readAsDataURL(imageFile);
      } else {
        const newNews = { title, content, image: null };
        newsData.push(newNews);
        saveNews(newsData);
        renderNews();
        document.getElementById('news-form').reset();
      }
    });

    // Render News
    function renderNews() {
      const newsContainer = document.getElementById('news-container');
      newsContainer.innerHTML = '';

      newsData.forEach((news) => {
        const newsElement = document.createElement('div');
        newsElement.innerHTML = `
          <h3>${news.title}</h3>
          <p>${news.content}</p>
          ${news.image ? `<img src="${news.image}" alt="News Image" style="max-width: 100%; height: auto;">` : ''}
          <hr>
        `;
        newsContainer.appendChild(newsElement);
      });
    }

    // Download JSON File
    document.getElementById('download-json').addEventListener('click', () => {
      const dataStr = JSON.stringify(newsData, null, 2); // Beautify JSON with indentation
      const blob = new Blob([dataStr], { type: "application/json" });
      const url = URL.createObjectURL(blob);

      const downloadLink = document.createElement('a');
      downloadLink.href = url;
      downloadLink.download = 'newsData.json';
      downloadLink.click();

      URL.revokeObjectURL(url); // Cleanup URL object
    });
  </script>
</body>
</html>
